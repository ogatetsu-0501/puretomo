<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- ここでページの基本情報を設定します -->
    <meta charset="UTF-8" />
    <!-- 文字コードUTF-8に設定 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 画面サイズに合わせる -->
    <title>アバター管理画面</title>
    <!-- ページのタイトル -->

    <style>
      /* ----- 全体の基本設定 ----- */
      body {
        font-family: Arial, sans-serif; /* 読みやすいフォントを指定 */
        margin: 0; /* 余白なし */
        padding: 0; /* 余白なし */
        display: flex; /* 横並びに配置 */
        flex-direction: column; /* 上下に配置 */
        height: 100vh; /* 画面全体の高さにする */
      }
      /* ----- ヘッダー部分（ハンバーガーメニュー付き） ----- */
      header {
        display: flex; /* 横並び */
        align-items: center; /* 縦方向中央寄せ */
        background-color: #4caf50; /* ヘッダーの背景色（緑） */
        color: white; /* ヘッダーの文字色を白に */
        padding: 10px; /* 内側の余白 */
      }
      /* ハンバーガーメニューボタンのスタイル */
      .hamburger {
        font-size: 24px; /* 文字サイズ大きく */
        cursor: pointer; /* マウスポインタに */
        margin-right: 10px; /* 右側に少し余白 */
      }
      /* ----- メインエリア（左側：メニューと左パネル、右側：一覧表示） ----- */
      .main-container {
        flex: 1; /* 画面残り全体を使う */
        display: flex; /* 左右に配置 */
        overflow: hidden; /* はみ出しを隠す */
      }
      /* 左側のサイドバー（メニュー）のスタイル */
      .sidebar {
        width: 200px; /* サイドバーの幅 */
        background-color: #333; /* 背景を暗く */
        color: white; /* 文字色を白に */
        display: none; /* 初期は非表示 */
        flex-shrink: 0; /* 幅固定 */
      }
      /* サイドバー内のメニューリスト */
      .sidebar ul {
        list-style: none; /* 箇条書きの点をなくす */
        padding: 0; /* 内側余白なし */
        margin: 0; /* 外側余白なし */
      }
      .sidebar li {
        padding: 15px; /* 余白を設定 */
        cursor: pointer; /* マウスカーソルをポインターに */
      }
      .sidebar li:hover {
        background-color: #575757; /* ホバー時に背景色変更 */
      }
      /* 左側のコンテンツエリア（フォーム部分）のスタイル */
      .left-panel {
        width: 30%; /* 画面の30%の幅 */
        padding: 20px; /* 内側の余白 */
        box-sizing: border-box; /* パディングも含む */
      }
      /* 右側のエリア（一覧表示）のスタイル */
      .right-panel {
        width: 70%; /* 画面の70%の幅 */
        padding: 20px; /* 内側の余白 */
        box-sizing: border-box; /* パディングも含む */
        overflow-y: auto; /* 縦スクロール可能に */
      }
      /* ----- フォームや表の共通設定 ----- */
      .form-group {
        margin-bottom: 15px; /* フォームグループ間の下余白 */
      }
      input[type="text"],
      input[type="number"],
      select {
        width: 100%; /* 入力欄を横いっぱいに */
        padding: 5px; /* 内側の余白 */
        box-sizing: border-box; /* パディング含む幅計算 */
      }
      button {
        padding: 10px; /* ボタン内余白 */
        width: 100%; /* 幅いっぱい */
        background-color: #4caf50; /* 緑背景 */
        border: none; /* 枠線なし */
        color: white; /* 文字色白 */
        font-size: 16px; /* 文字サイズ16px */
        cursor: pointer; /* カーソルポインター */
      }
      button:disabled {
        background-color: #cccccc; /* 無効時はグレー */
        cursor: not-allowed; /* 使用不可カーソル */
      }
      /* 表形式の表示設定 */
      table {
        width: 100%; /* 表の幅いっぱい */
        border-collapse: collapse; /* セルの境界をくっつける */
      }
      th,
      td {
        border: 1px solid #ccc; /* セルの境界線 */
        padding: 8px; /* セル内余白 */
        text-align: center; /* 中央寄せ */
      }
      th {
        background-color: #e0e0e0; /* ヘッダーの背景色 */
      }
    </style>
  </head>
  <body>
    <!-- ヘッダー部分 -->
    <header>
      <!-- ハンバーガーメニューアイコン -->
      <div class="hamburger" id="hamburgerBtn">&#9776;</div>
      <!-- ヘッダーのタイトル -->
      <h1 style="margin: 0; font-size: 18px">アバター管理</h1>
    </header>

    <!-- メインエリア -->
    <div class="main-container">
      <!-- サイドバー（ハンバーガーメニューをクリックしたときに表示） -->
      <div class="sidebar" id="sidebar">
        <ul>
          <!-- メニュー項目 -->
          <li data-target="avatarForm">所持アバター追加</li>
          <li data-target="settings">設定</li>
        </ul>
      </div>

      <!-- 左側パネル：メニュー切り替えに応じたコンテンツ -->
      <div class="left-panel" id="leftPanel">
        <!-- 初期表示は「所持アバター追加」 -->
        <div id="avatarForm">
          <h2>所持アバター追加</h2>
          <!-- パーツ（予測変換付き） -->
          <div class="form-group">
            <label for="partInput">パーツ（表示名）:</label>
            <input
              type="text"
              id="partInput"
              list="partsList"
              autocomplete="on"
              placeholder="例: トップス"
            />
            <datalist id="partsList">
              <option value="トップス"></option>
              <option value="ボトムス"></option>
              <option value="ワンピース"></option>
              <option value="ヘアスタイル"></option>
              <option value="フェイス"></option>
              <option value="背景"></option>
              <option value="アウター"></option>
              <option value="セット衣装1"></option>
              <option value="セット衣装2"></option>
              <option value="帽子"></option>
              <option value="めがね"></option>
              <option value="アクセ1"></option>
              <option value="アクセ2"></option>
              <option value="雑貨1"></option>
              <option value="雑貨2"></option>
              <option value="ペット1"></option>
              <option value="ペット2"></option>
              <option value="ペット3"></option>
              <option value="ペット4"></option>
              <option value="エフェクト"></option>
              <option value="その他1"></option>
              <option value="その他2"></option>
              <option value="その他3"></option>
              <option value="その他4"></option>
              <option value="モイトイ"></option>
            </datalist>
          </div>
          <!-- 種類①（予測変換付き） -->
          <div class="form-group">
            <label for="type1Input">種類①:</label>
            <input
              type="text"
              id="type1Input"
              list="type1List"
              autocomplete="on"
              placeholder="例: INT"
            />
            <datalist id="type1List">
              <option value="INT"></option>
              <option value="ALL"></option>
              <option value="HPR"></option>
              <option value="SP"></option>
              <option value="PET"></option>
              <option value="HP"></option>
              <option value="SPR"></option>
              <option value="LUK"></option>
              <option value="ATK"></option>
              <option value="EXP"></option>
              <option value="MAT"></option>
              <option value="POW"></option>
              <option value="VIT"></option>
            </datalist>
          </div>
          <!-- 種類②（予測変換付き、任意） -->
          <div class="form-group">
            <label for="type2Input">種類②:</label>
            <input
              type="text"
              id="type2Input"
              list="type2List"
              autocomplete="on"
              placeholder="（未入力でも可）"
              disabled
            />
            <datalist id="type2List">
              <option value="INT"></option>
              <option value="ALL"></option>
              <option value="HPR"></option>
              <option value="SP"></option>
              <option value="PET"></option>
              <option value="HP"></option>
              <option value="SPR"></option>
              <option value="LUK"></option>
              <option value="ATK"></option>
              <option value="EXP"></option>
              <option value="MAT"></option>
              <option value="POW"></option>
              <option value="VIT"></option>
            </datalist>
          </div>
          <!-- 上昇値入力 -->
          <div class="form-group">
            <label for="valueInput">上昇値:</label>
            <input
              type="number"
              id="valueInput"
              placeholder="数値を入力してください"
            />
          </div>
          <!-- 追加ボタン -->
          <button id="addButton" disabled>追加</button>
        </div>

        <!-- 設定フォーム（初期は非表示） -->
        <div id="settings" style="display: none">
          <h2>設定</h2>
          <!-- アバター性別選択 -->
          <div class="form-group">
            <label for="genderSelect">アバター性別選択:</label>
            <!-- セレクトボックス。値はFまたはM、表示は「女」と「男」 -->
            <select id="genderSelect">
              <option value="F">女</option>
              <option value="M">男</option>
            </select>
          </div>
          <!-- 保存ボタン -->
          <button id="saveSettingsButton">設定を保存</button>
        </div>
      </div>

      <!-- 右側パネル：追加されたアバターの一覧を表形式で表示 -->
      <div class="right-panel">
        <h2>追加されたアバター一覧</h2>
        <table id="avatarTable">
          <thead>
            <tr>
              <th>パーツ</th>
              <th>種類①</th>
              <th>種類②</th>
              <th>上昇値</th>
              <th>削除</th>
            </tr>
          </thead>
          <tbody>
            <!-- JavaScriptで行が追加されます -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // ----- ハンバーガーメニューとサイドバーの処理 -----
      // ヘッダーのハンバーガーメニューボタンを取得
      const hamburgerBtn = document.getElementById("hamburgerBtn");
      // サイドバーの要素を取得
      const sidebar = document.getElementById("sidebar");

      // ハンバーガーメニューボタンをクリックしたときの処理
      hamburgerBtn.addEventListener("click", function () {
        // サイドバーが表示されていなければ表示、表示されていれば非表示にする
        if (sidebar.style.display === "none" || sidebar.style.display === "") {
          sidebar.style.display = "block";
        } else {
          sidebar.style.display = "none";
        }
      });

      // サイドバーのメニュー項目を取得し、クリック時の処理を設定
      const sidebarItems = document.querySelectorAll(".sidebar li");
      // 左側パネルの中身を入れ替えるエリアを取得
      const leftPanel = document.getElementById("leftPanel");
      // 「所持アバター追加」と「設定」の要素を取得
      const avatarFormDiv = document.getElementById("avatarForm");
      const settingsDiv = document.getElementById("settings");

      // サイドバーの各項目にクリックイベントを設定する
      sidebarItems.forEach(function (item) {
        item.addEventListener("click", function () {
          // 選択されたターゲットを取得（data-target属性）
          const target = item.getAttribute("data-target");
          // サイドバーを非表示にする
          sidebar.style.display = "none";
          // 所持アバター追加と設定を切り替える
          if (target === "avatarForm") {
            avatarFormDiv.style.display = "block";
            settingsDiv.style.display = "none";
          } else if (target === "settings") {
            avatarFormDiv.style.display = "none";
            settingsDiv.style.display = "block";
            // 設定のセレクトボックスはローカルストレージから復元
            const savedGender = localStorage.getItem("avatarGender");
            if (savedGender) {
              document.getElementById("genderSelect").value = savedGender;
            }
          }
        });
      });

      // ----- アバター追加フォームの処理 -----
      // パーツ表示名から隠し値へのマッピングオブジェクト
      const partsMapping = {
        トップス: "H",
        ボトムス: "L",
        ワンピース: "HL",
        ヘアスタイル: "P",
        フェイス: "F",
        背景: "A4",
        アウター: "CT",
        セット衣装1: "SA",
        セット衣装2: "SB",
        帽子: "AE",
        めがね: "AD",
        アクセ1: "AF",
        アクセ2: "B2",
        雑貨1: "B1",
        雑貨2: "B3",
        ペット1: "E1",
        ペット2: "E2",
        ペット3: "E3",
        ペット4: "E4",
        エフェクト: "AA",
        その他1: "AB",
        その他2: "A1",
        その他3: "A2",
        その他4: "A3",
        モイトイ: "BL",
      };

      // 種類の候補リスト
      const typeOptions = [
        "INT",
        "ALL",
        "HPR",
        "SP",
        "PET",
        "HP",
        "SPR",
        "LUK",
        "ATK",
        "EXP",
        "MAT",
        "POW",
        "VIT",
      ];

      // グローバルなアバター情報リスト
      let avatarList = [];
      // ページ読み込み時にローカルストレージから復元
      window.addEventListener("load", function () {
        const storedData = localStorage.getItem("avatarList");
        if (storedData) {
          avatarList = JSON.parse(storedData);
          renderTable();
        }
      });

      // 各入力欄とボタン、テーブルの要素を取得
      const partInput = document.getElementById("partInput");
      const type1Input = document.getElementById("type1Input");
      const type2Input = document.getElementById("type2Input");
      const valueInput = document.getElementById("valueInput");
      const addButton = document.getElementById("addButton");
      const avatarTableBody = document.querySelector("#avatarTable tbody");

      // 種類①入力欄が変更されたときの処理
      type1Input.addEventListener("change", function () {
        const selectedType1 = type1Input.value.trim();
        if (selectedType1 === "") {
          // 種類①が空なら種類②を無効にして空にする
          type2Input.disabled = true;
          type2Input.value = "";
        } else {
          // 種類①が入力されたら種類②を有効にし、候補を更新
          type2Input.disabled = false;
          updateType2Datalist(selectedType1);
        }
        checkInput();
      });

      // パーツ、種類①、上昇値の入力が変更されたらチェック
      partInput.addEventListener("input", checkInput);
      type1Input.addEventListener("input", checkInput);
      valueInput.addEventListener("input", checkInput);

      // 入力必須項目のチェック：パーツ・種類①・上昇値
      function checkInput() {
        const isPartEntered = partInput.value.trim() !== "";
        const isType1Entered = type1Input.value.trim() !== "";
        const isValueEntered =
          valueInput.value.trim() !== "" && !isNaN(valueInput.value);
        if (isPartEntered && isType1Entered && isValueEntered) {
          addButton.disabled = false;
        } else {
          addButton.disabled = true;
        }
      }

      // 種類②のdatalist更新関数
      function updateType2Datalist(selectedType1) {
        const type2Datalist = document.getElementById("type2List");
        type2Datalist.innerHTML = "";
        // 空の候補を追加
        const emptyOption = document.createElement("option");
        emptyOption.value = "";
        type2Datalist.appendChild(emptyOption);
        // 種類①で選ばれたもの以外の候補を追加
        typeOptions.forEach(function (option) {
          if (option !== selectedType1) {
            const opt = document.createElement("option");
            opt.value = option;
            type2Datalist.appendChild(opt);
          }
        });
      }

      // 追加ボタンがクリックされたときの処理
      addButton.addEventListener("click", function () {
        const partText = partInput.value.trim();
        const partValue = partsMapping[partText] || "";
        const type1Value = type1Input.value.trim();
        // 種類②は未入力なら"なし"とする
        const type2Value =
          type2Input.value.trim() === "" ? "なし" : type2Input.value.trim();
        const increaseValue = valueInput.value.trim();

        // マッピングに該当しなければ警告して中断
        if (partValue === "") {
          alert("パーツ入力が正しくありません。候補から選んでください。");
          return;
        }

        // 新しいアバター情報を作成してリストに追加
        const newAvatar = {
          partText: partText,
          partValue: partValue,
          type1: type1Value,
          type2: type2Value,
          increase: increaseValue,
        };
        avatarList.push(newAvatar);
        renderTable();
        // ローカルストレージに保存
        localStorage.setItem("avatarList", JSON.stringify(avatarList));

        // 入力欄をリセット
        partInput.value = "";
        type1Input.value = "";
        type2Input.value = "";
        type2Input.disabled = true;
        valueInput.value = "";
        checkInput();
      });

      // 表を再描画する関数
      function renderTable() {
        avatarTableBody.innerHTML = "";
        avatarList.forEach(function (avatar, index) {
          const row = document.createElement("tr");
          // パーツ（表示名）
          const partCell = document.createElement("td");
          partCell.textContent = avatar.partText;
          row.appendChild(partCell);
          // 種類①
          const type1Cell = document.createElement("td");
          type1Cell.textContent = avatar.type1;
          row.appendChild(type1Cell);
          // 種類②
          const type2Cell = document.createElement("td");
          type2Cell.textContent = avatar.type2;
          row.appendChild(type2Cell);
          // 上昇値
          const increaseCell = document.createElement("td");
          increaseCell.textContent = avatar.increase;
          row.appendChild(increaseCell);
          // 削除ボタン
          const deleteCell = document.createElement("td");
          const delButton = document.createElement("button");
          delButton.textContent = "削除";
          delButton.addEventListener("click", function () {
            // リストから削除
            avatarList.splice(index, 1);
            renderTable();
            localStorage.setItem("avatarList", JSON.stringify(avatarList));
          });
          deleteCell.appendChild(delButton);
          row.appendChild(deleteCell);
          avatarTableBody.appendChild(row);
        });
      }

      // ----- 設定フォームの処理 -----
      // 設定の保存ボタンを取得
      const saveSettingsButton = document.getElementById("saveSettingsButton");
      const genderSelect = document.getElementById("genderSelect");

      // 保存ボタンがクリックされたときの処理
      saveSettingsButton.addEventListener("click", function () {
        // 選択された性別の値を取得（"F" または "M"）
        const selectedGender = genderSelect.value;
        // ローカルストレージに保存
        localStorage.setItem("avatarGender", selectedGender);
        alert("設定を保存しました。");
      });
    </script>
  </body>
</html>
